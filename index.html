<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huawei AI Chat Box</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #4b2e2e, #8b0000); /* Huawei brownish-red gradient */
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .chat-container {
            width: 100vw;
            height: 100vh;
            background: #ffffff;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        .sidebar {
            width: 300px;
            background: #f9f5f2; /* Light cream */
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            animation: fadeInSidebar 0.8s ease;
        }

        .sidebar-header {
            background: #4b2e2e; /* Huawei deep brownish-red */
            color: #ffffff;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: 10px;
        }

        .clear-history-btn {
            background: #ff4d4f;
            color: #ffffff;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            text-align: center;
            transition: background 0.3s, transform 0.2s;
        }

        .clear-history-btn:hover {
            background: #e63946;
            transform: scale(1.05);
        }

        .history-item {
            background: #e8e1dc; /* Light taupe */
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .history-item:hover {
            background: #d5ccc5;
            transform: translateX(5px);
        }

        .history-item span {
            font-size: 0.75rem;
            color: #666;
            display: block;
        }

        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .chat-header {
            background: #4b2e2e; /* Huawei deep brownish-red */
            color: #ffffff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .chat-header h2 {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .chat-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #ffffff;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.3s ease;
        }

        .message.user {
            align-items: flex-end;
        }

        .message.ai {
            align-items: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.95rem;
            line-height: 1.4;
            transition: transform 0.2s;
        }

        .message-content:hover {
            transform: scale(1.02);
        }

        .user .message-content {
            background: #8b0000; /* Huawei vibrant reddish-brown */
            color: #ffffff;
            border-bottom-right-radius: 5px;
        }

        .ai .message-content {
            background: #e8e1dc; /* Light taupe */
            color: #333;
            border-bottom-left-radius: 5px;
        }

        .message img {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 5px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
            width: 40px;
            height: 40px;
        }

        .loading div {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #8b0000; /* Huawei reddish-brown */
            border-radius: 50%;
            animation: pulse 1.2s ease-in-out infinite;
        }

        .loading div:nth-child(1) { transform: rotate(0deg) translate(16px); animation-delay: 0s; }
        .loading div:nth-child(2) { transform: rotate(45deg) translate(16px); animation-delay: 0.15s; }
        .loading div:nth-child(3) { transform: rotate(90deg) translate(16px); animation-delay: 0.3s; }
        .loading div:nth-child(4) { transform: rotate(135deg) translate(16px); animation-delay: 0.45s; }
        .loading div:nth-child(5) { transform: rotate(180deg) translate(16px); animation-delay: 0.6s; }
        .loading div:nth-child(6) { transform: rotate(225deg) translate(16px); animation-delay: 0.75s; }
        .loading div:nth-child(7) { transform: rotate(270deg) translate(16px); animation-delay: 0.9s; }
        .loading div:nth-child(8) { transform: rotate(315deg) translate(16px); animation-delay: 1.05s; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.5); opacity: 1; }
        }

        .chat-input {
            padding: 15px;
            background: #ffffff;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            animation: slideUp 0.5s ease;
        }

        .chat-input input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
            transition: border-color 0.3s, transform 0.2s;
            min-width: 150px;
        }

        .chat-input input[type="text"]:focus {
            border-color: #8b0000;
            transform: scale(1.02);
        }

        .chat-input input[type="file"] {
            display: none;
        }

        .chat-input button, .chat-input label {
            padding: 8px;
            background: #4b2e2e;
            color: #ffffff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s, transform 0.2s;
        }

        .chat-input button:hover, .chat-input label:hover {
            background: #6b3e3e;
            transform: scale(1.1);
        }

        .chat-input .voice-active, .chat-input .tts-active {
            background: #ff4d4f;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInSidebar {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: 30vh;
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }

            .chat-main {
                height: calc(100vh - 30vh);
            }

            .chat-header h2 {
                font-size: 1rem;
            }

            .message-content {
                max-width: 80%;
                font-size: 0.85rem;
            }

            .chat-input {
                padding: 10px;
                gap: 6px;
            }

            .loading {
                width: 32px;
                height: 32px;
            }

            .loading div {
                width: 6px;
                height: 6px;
                transform: translate(12px);
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                height: 25vh;
            }

            .chat-main {
                height: calc(100vh - 25vh);
            }

            .chat-header h2 {
                font-size: 0.9rem;
            }

            .message-content {
                font-size: 0.8rem;
            }

            .history-item {
                font-size: 0.8rem;
            }

            .history-item span {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="sidebar">
            <div class="sidebar-header">Conversation Topics</div>
            <button class="clear-history-btn" id="clear-history-btn">Clear History</button>
            <div id="history-list"></div>
        </div>
        <div class="chat-main">
            <div class="chat-header">
                <img src="https://via.placeholder.com/40" alt="Huawei AI Avatar">
                <h2>Huawei AI Assistant</h2>
            </div>
            <div class="chat-body" id="chat-body">
                <!-- Messages will be populated by JavaScript -->
            </div>
            <div class="chat-input">
                <input type="text" id="message-input" placeholder="Type your message...">
                <label for="image-upload">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </label>
                <input type="file" id="image-upload" accept="image/*">
                <button id="voice-btn" title="Start/Stop Voice Input">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v8"></path>
                        <path d="M17 3a5 5 0 0 1 0 10"></path>
                        <path d="M7 3a5 5 0 0 0 0 10"></path>
                        <path d="M12 14v8"></path>
                    </svg>
                </button>
                <button id="tts-btn" title="Toggle Text-to-Speech">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 15v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4"></path>
                        <polyline points="7 9 12 4 17 9"></polyline>
                        <line x1="12" y1="4" x2="12" y2="16"></line>
                    </svg>
                </button>
                <button id="send-btn">Send</button>
            </div>
        </div>
    </div>
    <script>
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        const synth = window.speechSynthesis;
        let isRecording = false;
        let isTtsEnabled = false;
        let currentTopicId = null;

        const voiceBtn = document.getElementById('voice-btn');
        const ttsBtn = document.getElementById('tts-btn');
        const sendBtn = document.getElementById('send-btn');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const messageInput = document.getElementById('message-input');
        const chatBody = document.getElementById('chat-body');
        const historyList = document.getElementById('history-list');

        // Load conversation history from localStorage
        let conversationHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
        let topics = organizeByTopics(conversationHistory);
        renderTopics();

        recognition.lang = 'en-US';
        recognition.continuous = false;

        voiceBtn.addEventListener('click', () => {
            if (isRecording) {
                recognition.stop();
                voiceBtn.classList.remove('voice-active');
                voiceBtn.querySelector('svg').innerHTML = `
                    <path d="M12 2v8"></path>
                    <path d="M17 3a5 5 0 0 1 0 10"></path>
                    <path d="M7 3a5 5 0 0 0 0 10"></path>
                    <path d="M12 14v8"></path>
                `;
            } else {
                recognition.start();
                voiceBtn.classList.add('voice-active');
                voiceBtn.querySelector('svg').innerHTML = `
                    <rect x="9" y="2" width="2" height="20"></rect>
                    <rect x="13" y="2" width="2" height="20"></rect>
                `;
            }
            isRecording = !isRecording;
        });

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            messageInput.value = transcript;
            addMessage(transcript, 'user', generateTopicId());
            if (isTtsEnabled) {
                speak(transcript);
            }
            simulateAIResponse(transcript);
        };

        recognition.onend = () => {
            if (isRecording) {
                recognition.stop();
                voiceBtn.classList.remove('voice-active');
                voiceBtn.querySelector('svg').innerHTML = `
                    <path d="M12 2v8"></path>
                    <path d="M17 3a5 5 0 0 1 0 10"></path>
                    <path d="M7 3a5 5 0 0 0 0 10"></path>
                    <path d="M12 14v8"></path>
                `;
                isRecording = false;
            }
        };

        ttsBtn.addEventListener('click', () => {
            isTtsEnabled = !isTtsEnabled;
            ttsBtn.classList.toggle('tts-active', isTtsEnabled);
        });

        sendBtn.addEventListener('click', () => {
            const text = messageInput.value.trim();
            if (text) {
                addMessage(text, 'user', generateTopicId());
                if (isTtsEnabled) {
                    speak(text);
                }
                messageInput.value = '';
                simulateAIResponse(text);
            }
        });

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });

        document.getElementById('image-upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    addMessage('Image uploaded!', 'user', generateTopicId(), event.target.result);
                    simulateAIResponse('Image received!');
                };
                reader.readAsDataURL(file);
            }
        });

        clearHistoryBtn.addEventListener('click', () => {
            conversationHistory = [];
            topics = {};
            localStorage.setItem('chatHistory', JSON.stringify(conversationHistory));
            chatBody.innerHTML = '';
            historyList.innerHTML = '';
            currentTopicId = null;
        });

        function generateTopicId() {
            if (!currentTopicId) {
                currentTopicId = `topic-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;
            }
            return currentTopicId;
        }

        function organizeByTopics(history) {
            const topics = {};
            history.forEach((msg, index) => {
                if (!msg.topicId) {
                    msg.topicId = `topic-${msg.timestamp}-${index}`;
                }
                if (!topics[msg.topicId]) {
                    topics[msg.topicId] = {
                        title: msg.type === 'user' ? (msg.image ? 'Image' : msg.text.substring(0, 30)) : null,
                        messages: [],
                        timestamp: msg.timestamp
                    };
                }
                topics[msg.topicId].messages.push({ ...msg, index });
                if (msg.type === 'user' && !topics[msg.topicId].title) {
                    topics[msg.topicId].title = msg.image ? 'Image' : msg.text.substring(0, 30);
                }
            });
            return topics;
        }

        function renderTopics() {
            historyList.innerHTML = '';
            Object.keys(topics).forEach(topicId => {
                const topic = topics[topicId];
                if (topic.title) {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    const displayText = topic.title.length > 30 ? topic.title.substring(0, 27) + '...' : topic.title;
                    const timestamp = new Date(topic.timestamp).toLocaleTimeString();
                    historyItem.innerHTML = `${displayText}<span>${timestamp}</span>`;
                    historyItem.addEventListener('click', () => {
                        currentTopicId = topicId;
                        chatBody.innerHTML = '';
                        topic.messages.forEach(msg => {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `message ${msg.type}`;
                            let content = msg.image ? `<img src="${msg.image}" alt="Uploaded Image">` : '';
                            content += `<div class="message-content">${msg.text}</div>`;
                            messageDiv.innerHTML = content;
                            chatBody.appendChild(messageDiv);
                        });
                        chatBody.scrollTop = chatBody.scrollHeight;
                    });
                    historyList.appendChild(historyItem);
                }
            });
            historyList.scrollTop = historyList.scrollHeight;
        }

        function addMessage(text, type, topicId, image = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            let content = image ? `<img src="${image}" alt="Uploaded Image">` : '';
            content += `<div class="message-content">${text}</div>`;
            messageDiv.innerHTML = content;

            if (currentTopicId === topicId) {
                chatBody.appendChild(messageDiv);
                chatBody.scrollTop = chatBody.scrollHeight;
            }

            // Save to conversation history
            conversationHistory.push({ text, type, image, timestamp: new Date().toISOString(), topicId });
            localStorage.setItem('chatHistory', JSON.stringify(conversationHistory));
            topics = organizeByTopics(conversationHistory);
            renderTopics();
        }

        function showLoading() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.id = 'loading';
            for (let i = 0; i < 8; i++) {
                const dot = document.createElement('div');
                loadingDiv.appendChild(dot);
            }
            chatBody.appendChild(loadingDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function hideLoading() {
            const loadingDiv = document.getElementById('loading');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        function simulateAIResponse(userMessage) {
            showLoading();
            setTimeout(() => {
                hideLoading();
                const aiResponse = `Thanks for your message: "${userMessage}". How can I assist you next?`;
                addMessage(aiResponse, 'ai', currentTopicId);
                currentTopicId = null; // Reset topic for new user input
            }, 1000);
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            synth.speak(utterance);
        }
    </script>
</body>
</html>